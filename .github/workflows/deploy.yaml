name: Deploy to production

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Latest Repo
        uses: actions/checkout@v2
      
      - run: npm install
      - run: npm run build

      - name: rsync deployments
        uses: contention/rsync-deployments@v2.0.0
        with:
          FLAGS: -avzr --delete
          EXCLUDES: --exclude .htaccess --exclude /uploads/
          USER: ubuntu
          HOST: ec2-35-154-16-135.ap-south-1.compute.amazonaws.com
          LOCALPATH: /build/
          REMOTEPATH: /var/www/html/
          DEPLOY_KEY: ${{ secrets.PRIVATE_KEY }}
